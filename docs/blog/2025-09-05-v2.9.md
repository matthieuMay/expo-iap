---
slug: v2.9
title: v2.9 - OpenIAP Apple Integration
authors: [hyochan]
tags: [release, openiap, ios, architecture, performance]
date: 2025-09-05
---

# v2.9 Release Notes

We're excited to announce v2.9, featuring full integration with OpenIAP Apple that reduces our Swift codebase by **~1,180 lines (73% reduction)**!

<!-- truncate -->

import AdFitTopFixed from "@site/src/uis/AdFitTopFixed";

<AdFitTopFixed />

## üéØ OpenIAP Apple Integration

The core achievement of this release is integrating [OpenIAP Apple](https://github.com/hyodotdev/openiap-apple) v1.1.5 as our iOS native module.

### Code Reduction Impact

- **Before**: 1,620 lines of Swift code
- **After**: 440 lines of Swift code
- **Reduction**: ~1,180 lines (73% less code to maintain!)

## üèóÔ∏è Architecture Evolution

### Before (v2.8.x)

```txt
Expo IAP ‚Üí Custom Swift Implementation ‚Üí StoreKit 2
         (1,620 lines of complex logic)
```

### After (v2.9.0)

```txt
Expo IAP ‚Üí OpenIAP Apple ‚Üí StoreKit 2
         (440 lines)    (Specialized native module)
```

## ‚ú® What's New

### Enhanced Type System

Following [OpenIAP v1.1.0 specification](https://www.openiap.dev/docs/versions#v1-1-0):

- `ProductRequest` for product fetching
- `RequestPurchaseProps` for purchase requests
- `ReceiptValidationProps` for receipt validation
- `PurchaseError` with native error code mapping
- No more deep imports: `ProductAndroid`, `ProductIOS`, `PaymentDiscount` and other types are exported from `expo-iap` root

### Thread Safety

- All iOS operations now use `@MainActor` annotation
- Prevents race conditions and ensures main thread execution

### Unified Event System

- Renamed `IapEvent` to `OpenIapEvent`
- Streamlined listeners: `purchaseUpdatedListener`, `purchaseErrorListener`
- Added `removeAllListeners()` for cleanup

## üêõ Bug Fixes

- Fixed duplicate purchase success alerts
- Resolved restore purchase alerts on screen entry
- Improved purchase validation logic
- Enhanced subscription status refresh timing
- Better deduplication of purchases by productId

## üíî Breaking Changes

### IapEvent ‚Üí OpenIapEvent

```typescript
// ‚ùå Old
import {OpenIapEvent} from 'expo-iap';

purchaseUpdatedListener((purchase) => {}, OpenIapEvent.PurchaseUpdated);

// ‚úÖ New
import {OpenIapEvent} from 'expo-iap';

purchaseUpdatedListener((purchase) => {}, OpenIapEvent.PurchaseUpdated);
```

## üöÄ Looking Ahead: v3.0.0

This release sets the foundation for v3.0.0:

- **Android**: OpenIAP Android integration (Google Play Billing)
- **Bundle Size**: Further optimizations through shared native libraries
- **Maintenance**: Unified native module architecture

## üí° Benefits

1. **Reliability**: Battle-tested native modules reduce edge cases
2. **Maintainability**: 73% less code in Expo IAP layer
3. **Performance**: Optimized native implementations
4. **Future-proof**: Easier platform updates

## üì¶ Installation

```bash
npm install expo-iap@2.9.0
# or
yarn add expo-iap@2.9.0
# or
bun add expo-iap@2.9.0
```

## üìã Full Changelog

### Added

- **iOS**: Integrated OpenIAP Apple v1.1.6
- Updated types to match OpenIAP v1.1.0 specification
- Enhanced error handling with `PurchaseError` type
- New type system: `ProductRequest`, `RequestPurchaseProps`, `ReceiptValidationProps`
- Improved receipt validation with `ReceiptValidationResult`

### Changed

- Updated `serializePurchase` and `serializeProduct` for new OpenIAP structure
- Updated listener setup to use new OpenIAP methods
- Renamed `IapEvent` to `OpenIapEvent` across entire codebase
- Added unified `removeAllListeners()` for cleanup
- Avoid deep imports: import public types directly from `expo-iap`

### Fixed

- Fixed duplicate purchase success alerts
- Fixed restore purchase alerts on screen entry
- Improved purchase validation logic
- Enhanced subscription deduplication

### Note

- Android native module integration with OpenIAP Android planned for v3.0.0

## üôè Acknowledgments

Special thanks to the [OpenIAP](https://www.openiap.dev) project for providing standardized, high-quality native modules.

For detailed changes, see [PR #184](https://github.com/hyochan/expo-iap/pull/184).

Questions? Visit [GitHub Issues](https://github.com/hyochan/expo-iap/issues)!
