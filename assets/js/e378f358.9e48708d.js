"use strict";(globalThis.webpackChunkexpo_iap_docs=globalThis.webpackChunkexpo_iap_docs||[]).push([[6332],{571:(e,n,s)=>{s.d(n,{A:()=>t});var i=s(6540),r=s(4848);function o({className:e="adfit",style:n,unit:s,height:o,width:t}){return(0,i.useEffect)(()=>{const n=setTimeout(()=>{const n=document.querySelector(`.${e}`);if(!n)return void console.warn(`AdFit: Element with class "${e}" not found`);const i=n.querySelectorAll(".kakao_ad_area"),r=n.querySelectorAll('script[src*="kas/static/ba.min.js"]');i.forEach(e=>e.remove()),r.forEach(e=>e.remove());const d=document.createElement("ins"),l=document.createElement("script");d.className="kakao_ad_area",d.style.cssText="display:none; width:100%;",l.async=!0,l.type="text/javascript",l.src="//t1.daumcdn.net/kas/static/ba.min.js",d.setAttribute("data-ad-width",t.toString()),d.setAttribute("data-ad-height",o.toString()),d.setAttribute("data-ad-unit",s),n.appendChild(d),n.appendChild(l)},100);return()=>clearTimeout(n)},[e,s,o,t]),(0,r.jsx)("div",{style:n,children:(0,r.jsx)("div",{className:e})})}function t(){return(0,r.jsx)(o,{unit:"DAN-YTmjDwlbcP42HBg6",height:100,width:320,className:"adfit-top",style:{flex:1,marginTop:24,marginBottom:24}})}},7482:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>p,frontMatter:()=>d,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"getting-started/setup-android","title":"Android Setup","description":"Setting up in-app purchases for Android requires configuration in Google Play Console and proper Android app setup.","source":"@site/versioned_docs/version-2.6/getting-started/setup-android.md","sourceDirName":"getting-started","slug":"/getting-started/setup-android","permalink":"/expo-iap/docs/2.6/getting-started/setup-android","draft":false,"unlisted":false,"editUrl":"https://github.com/hyochan/expo-iap/tree/main/docs/versioned_docs/version-2.6/getting-started/setup-android.md","tags":[],"version":"2.6","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"iOS Setup","permalink":"/expo-iap/docs/2.6/getting-started/setup-ios"},"next":{"title":"Purchases","permalink":"/expo-iap/docs/2.6/guides/purchases"}}');var r=s(4848),o=s(8453),t=s(571);const d={sidebar_position:2},l="Android Setup",c={},a=[{value:"Google Play Console Configuration",id:"google-play-console-configuration",level:2},{value:"1. Create Your App",id:"1-create-your-app",level:3},{value:"2. Set Up In-App Products",id:"2-set-up-in-app-products",level:3},{value:"3. Configure Product Details",id:"3-configure-product-details",level:3},{value:"4. Set Up Subscriptions (Optional)",id:"4-set-up-subscriptions-optional",level:3},{value:"Android App Configuration",id:"android-app-configuration",level:2},{value:"1. Google Play Billing Dependencies",id:"1-google-play-billing-dependencies",level:3},{value:"2. Permissions",id:"2-permissions",level:3},{value:"3. ProGuard Configuration",id:"3-proguard-configuration",level:3},{value:"Testing Setup",id:"testing-setup",level:2},{value:"1. Upload to Play Console",id:"1-upload-to-play-console",level:3},{value:"2. Create Test Accounts",id:"2-create-test-accounts",level:3},{value:"3. Test Payment Method",id:"3-test-payment-method",level:3},{value:"Code Integration",id:"code-integration",level:2},{value:"Basic Setup",id:"basic-setup",level:3},{value:"Android-Specific Product Handling",id:"android-specific-product-handling",level:3},{value:"Android-Specific Subscription Handling",id:"android-specific-subscription-handling",level:3},{value:"Error Handling for Android",id:"error-handling-for-android",level:3},{value:"Common Issues",id:"common-issues",level:2},{value:"Product IDs Not Found",id:"product-ids-not-found",level:3},{value:"Testing Issues",id:"testing-issues",level:3},{value:"Purchase Flow Issues",id:"purchase-flow-issues",level:3},{value:"Subscription Issues",id:"subscription-issues",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Next Steps",id:"next-steps",level:2}];function u(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"android-setup",children:"Android Setup"})}),"\n",(0,r.jsx)(t.A,{}),"\n",(0,r.jsx)(n.p,{children:"Setting up in-app purchases for Android requires configuration in Google Play Console and proper Android app setup."}),"\n",(0,r.jsx)(n.h2,{id:"google-play-console-configuration",children:"Google Play Console Configuration"}),"\n",(0,r.jsx)(n.h3,{id:"1-create-your-app",children:"1. Create Your App"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Sign in to ",(0,r.jsx)(n.a,{href:"https://play.google.com/console/",children:"Google Play Console"})]}),"\n",(0,r.jsx)(n.li,{children:"Create a new app or select your existing app"}),"\n",(0,r.jsx)(n.li,{children:"Complete the app information and store listing"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"2-set-up-in-app-products",children:"2. Set Up In-App Products"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Navigate to ",(0,r.jsx)(n.strong,{children:"Monetize"})," > ",(0,r.jsx)(n.strong,{children:"Products"})," > ",(0,r.jsx)(n.strong,{children:"In-app products"})]}),"\n",(0,r.jsxs)(n.li,{children:["Click ",(0,r.jsx)(n.strong,{children:"Create product"})]}),"\n",(0,r.jsxs)(n.li,{children:["Choose your product type:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Managed product"}),": One-time purchase (non-consumable)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Consumable"}),": Can be purchased multiple times"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"3-configure-product-details",children:"3. Configure Product Details"}),"\n",(0,r.jsx)(n.p,{children:"For each product, provide:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Product ID"}),": Unique identifier (e.g., ",(0,r.jsx)(n.code,{children:"premium_upgrade"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Name"}),": Product name shown to users"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Description"}),": Product description"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Default price"}),": Set pricing for different countries"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Status"}),": Activate the product"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"4-set-up-subscriptions-optional",children:"4. Set Up Subscriptions (Optional)"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Navigate to ",(0,r.jsx)(n.strong,{children:"Monetize"})," > ",(0,r.jsx)(n.strong,{children:"Products"})," > ",(0,r.jsx)(n.strong,{children:"Subscriptions"})]}),"\n",(0,r.jsxs)(n.li,{children:["Click ",(0,r.jsx)(n.strong,{children:"Create subscription"})]}),"\n",(0,r.jsxs)(n.li,{children:["Configure subscription details:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Product ID"}),": Unique identifier"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Base plans"}),": Pricing and billing periods"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Offers"}),": Special pricing (optional)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"android-app-configuration",children:"Android App Configuration"}),"\n",(0,r.jsx)(n.h3,{id:"1-google-play-billing-dependencies",children:"1. Google Play Billing Dependencies"}),"\n",(0,r.jsx)(n.p,{children:"Expo IAP automatically includes the necessary Google Play Billing dependencies. No manual configuration needed."}),"\n",(0,r.jsx)(n.h3,{id:"2-permissions",children:"2. Permissions"}),"\n",(0,r.jsxs)(n.p,{children:["The required billing permission is automatically added. Your ",(0,r.jsx)(n.code,{children:"android/app/src/main/AndroidManifest.xml"})," should include:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:'<uses-permission android:name="com.android.vending.BILLING" />\n'})}),"\n",(0,r.jsx)(n.h3,{id:"3-proguard-configuration",children:"3. ProGuard Configuration"}),"\n",(0,r.jsxs)(n.p,{children:["If you're using ProGuard, add these rules to your ",(0,r.jsx)(n.code,{children:"android/app/proguard-rules.pro"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-proguard",children:"-keep class com.android.vending.billing.**\n"})}),"\n",(0,r.jsx)(n.h2,{id:"testing-setup",children:"Testing Setup"}),"\n",(0,r.jsx)(n.h3,{id:"1-upload-to-play-console",children:"1. Upload to Play Console"}),"\n",(0,r.jsx)(n.p,{children:"To test in-app purchases, you must upload your app to Google Play Console:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Build a signed APK/AAB"}),"\n",(0,r.jsxs)(n.li,{children:["Upload to ",(0,r.jsx)(n.strong,{children:"Internal testing"})," track"]}),"\n",(0,r.jsx)(n.li,{children:"Add test users to the testing track"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"2-create-test-accounts",children:"2. Create Test Accounts"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["In Play Console, go to ",(0,r.jsx)(n.strong,{children:"Setup"})," > ",(0,r.jsx)(n.strong,{children:"License testing"})]}),"\n",(0,r.jsx)(n.li,{children:"Add Gmail accounts as test users"}),"\n",(0,r.jsx)(n.li,{children:"Test users can make purchases without being charged"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"3-test-payment-method",children:"3. Test Payment Method"}),"\n",(0,r.jsx)(n.p,{children:"Test users should:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Use the added test Gmail account on their device"}),"\n",(0,r.jsx)(n.li,{children:"Have a valid payment method (won't be charged for test purchases)"}),"\n",(0,r.jsx)(n.li,{children:"Install the app from the testing track"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"code-integration",children:"Code Integration"}),"\n",(0,r.jsx)(n.h3,{id:"basic-setup",children:"Basic Setup"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import {useIAP, ErrorCode} from 'expo-iap';\n\nconst androidProductIds = [\n  'premium_upgrade',\n  'coins_100',\n  'monthly_subscription',\n];\n\nfunction App() {\n  const {\n    connected,\n    products,\n    subscriptions,\n    getProducts,\n    getSubscriptions,\n    requestPurchase,\n  } = useIAP({\n    onPurchaseSuccess: (purchase) => {\n      console.log('Purchase successful:', purchase);\n      handleSuccessfulPurchase(purchase);\n    },\n    onPurchaseError: (error) => {\n      console.error('Purchase failed:', error);\n      handlePurchaseError(error);\n    },\n  });\n\n  React.useEffect(() => {\n    if (connected) {\n      // Fetch products and subscriptions\n      getProducts(\n        androidProductIds.filter((id) => !id.includes('subscription')),\n      );\n      getSubscriptions(\n        androidProductIds.filter((id) => id.includes('subscription')),\n      );\n    }\n  }, [connected]);\n\n  return (\n    <View>\n      {/* Render products */}\n      {products.map((product) => (\n        <AndroidProductItem key={product.id} product={product} />\n      ))}\n\n      {/* Render subscriptions */}\n      {subscriptions.map((subscription) => (\n        <AndroidSubscriptionItem\n          key={subscription.id}\n          subscription={subscription}\n        />\n      ))}\n    </View>\n  );\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"android-specific-product-handling",children:"Android-Specific Product Handling"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"const AndroidProductItem = ({product}: {product: Product}) => {\n  const {requestPurchase} = useIAP();\n\n  const handlePurchase = () => {\n    if (product.platform === 'android') {\n      requestPurchase({\n        request: {skus: [product.id]},\n        type: 'inapp',\n      });\n    }\n  };\n\n  if (product.platform !== 'android') return null;\n\n  return (\n    <TouchableOpacity onPress={handlePurchase}>\n      <Text>{product.title}</Text>\n      <Text>{product.oneTimePurchaseOfferDetails?.formattedPrice}</Text>\n    </TouchableOpacity>\n  );\n};\n"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\ud83d\udca1 Cross-Platform Note:"})," This example shows Android-specific usage with ",(0,r.jsx)(n.code,{children:"skus"}),". For cross-platform compatibility, include both ",(0,r.jsx)(n.code,{children:"sku"})," and ",(0,r.jsx)(n.code,{children:"skus"})," in your request object. See the ",(0,r.jsx)(n.a,{href:"/docs/api/methods/core-methods#requestpurchase",children:"Core Methods"})," documentation for details."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"android-specific-subscription-handling",children:"Android-Specific Subscription Handling"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"const AndroidSubscriptionItem = ({\n  subscription,\n}: {\n  subscription: ProductSubscription;\n}) => {\n  const {requestPurchase} = useIAP();\n\n  const handleSubscribe = (offer: any) => {\n    if (subscription.platform === 'android') {\n      requestPurchase({\n        request: {\n          skus: [subscription.id],\n          subscriptionOffers: [\n            {\n              sku: subscription.id,\n              offerToken: offer.offerToken,\n            },\n          ],\n        },\n        type: 'subs',\n      });\n    }\n  };\n\n  if (subscription.platform !== 'android') return null;\n\n  return (\n    <View>\n      <Text>{subscription.title}</Text>\n      {subscription.subscriptionOfferDetails?.map((offer) => (\n        <TouchableOpacity\n          key={offer.offerId}\n          onPress={() => handleSubscribe(offer)}\n        >\n          <Text>\n            {offer.pricingPhases.pricingPhaseList\n              .map((phase) => `${phase.formattedPrice}/${phase.billingPeriod}`)\n              .join(' then ')}\n          </Text>\n        </TouchableOpacity>\n      ))}\n    </View>\n  );\n};\n"})}),"\n",(0,r.jsx)(n.h3,{id:"error-handling-for-android",children:"Error Handling for Android"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"const handleAndroidError = (error: PurchaseError) => {\n  switch (error.code) {\n    case ErrorCode.UserCancelled:\n      // User cancelled - no action needed\n      break;\n    case ErrorCode.ItemUnavailable:\n      Alert.alert(\n        'Product Unavailable',\n        'This item is not available for purchase',\n      );\n      break;\n    case ErrorCode.ServiceError:\n      Alert.alert('Service Error', 'Google Play services are unavailable');\n      break;\n    case ErrorCode.DeveloperError:\n      Alert.alert('Configuration Error', 'Please contact support');\n      break;\n    default:\n      Alert.alert('Purchase Failed', error.message);\n  }\n};\n"})}),"\n",(0,r.jsx)(n.h2,{id:"common-issues",children:"Common Issues"}),"\n",(0,r.jsx)(n.h3,{id:"product-ids-not-found",children:"Product IDs Not Found"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),": Products return empty or show as unavailable ",(0,r.jsx)(n.strong,{children:"Solutions"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Verify product IDs match exactly between code and Play Console"}),"\n",(0,r.jsxs)(n.li,{children:["Ensure products are ",(0,r.jsx)(n.strong,{children:"Active"})," in Play Console"]}),"\n",(0,r.jsx)(n.li,{children:"Check that app is uploaded to at least Internal testing track"}),"\n",(0,r.jsx)(n.li,{children:"Verify the app package name matches"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"testing-issues",children:"Testing Issues"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),': "Item not found" or "Authentication required" errors ',(0,r.jsx)(n.strong,{children:"Solutions"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use Gmail accounts added as test users"}),"\n",(0,r.jsx)(n.li,{children:"Install app from testing track, not directly via ADB"}),"\n",(0,r.jsx)(n.li,{children:"Ensure test user has a valid payment method"}),"\n",(0,r.jsx)(n.li,{children:"Clear Google Play Store cache and data"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"purchase-flow-issues",children:"Purchase Flow Issues"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),": Purchase dialog doesn't appear or fails immediately ",(0,r.jsx)(n.strong,{children:"Solutions"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Verify Google Play services are updated"}),"\n",(0,r.jsx)(n.li,{children:"Check device has valid Google account"}),"\n",(0,r.jsx)(n.li,{children:"Ensure app is properly signed"}),"\n",(0,r.jsx)(n.li,{children:"Test on different devices"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"subscription-issues",children:"Subscription Issues"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem"}),": Subscription offers not showing or failing ",(0,r.jsx)(n.strong,{children:"Solutions"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Verify base plans are properly configured"}),"\n",(0,r.jsx)(n.li,{children:"Check offer eligibility rules"}),"\n",(0,r.jsx)(n.li,{children:"Ensure proper offer token handling"}),"\n",(0,r.jsx)(n.li,{children:"Test with different user accounts"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Always test on real devices"})," - emulators may have issues with Google Play services"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Use proper product IDs"})," - follow reverse domain naming (com.yourapp.product)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Handle all error cases"})," - especially network and service errors"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Test with multiple accounts"})," - verify behavior for new and existing users"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Implement proper retry logic"})," - for transient failures"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"../guides/getting-started",children:"Learn about getting started guide"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"./setup-ios",children:"Explore iOS setup"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"../api/error-codes",children:"Understand error codes"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>d});var i=s(6540);const r={},o=i.createContext(r);function t(e){const n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);